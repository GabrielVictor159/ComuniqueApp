{"version":3,"sources":["FlingGestureHandler.ts"],"names":["State","Direction","GestureHandler","DEFAULT_MAX_DURATION_MS","DEFAULT_MIN_ACCEPTABLE_DELTA","DEFAULT_DIRECTION","RIGHT","DEFAULT_NUMBER_OF_TOUCHES_REQUIRED","FlingGestureHandler","init","ref","propsRef","updateGestureConfig","enabled","props","config","direction","numberOfPointers","numberOfPointersRequired","transformNativeEvent","rect","view","getBoundingClientRect","x","tracker","getLastAvgX","left","y","getLastAvgY","top","absoluteX","absoluteY","startFling","event","startX","startY","begin","maxNumberOfPointersSimultaneously","delayTimeout","setTimeout","fail","maxDurationMs","tryEndFling","minAcceptableDelta","LEFT","UP","DOWN","clearTimeout","activate","endFling","onPointerDown","addToTracker","newPointerAction","onPointerAdd","currentState","UNDETERMINED","BEGAN","getTrackedPointersCount","onPointerMove","track","onPointerUp","onUp","onPointerRemove","removeFromTracker","pointerId","onPointerCancel","reset","force","end","resetConfig"],"mappings":"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","sourcesContent":["import { State } from '../../State';\nimport { Direction } from '../constants';\nimport { AdaptedEvent, Config } from '../interfaces';\n\nimport GestureHandler from './GestureHandler';\n\nconst DEFAULT_MAX_DURATION_MS = 800;\nconst DEFAULT_MIN_ACCEPTABLE_DELTA = 160;\nconst DEFAULT_DIRECTION = Direction.RIGHT;\nconst DEFAULT_NUMBER_OF_TOUCHES_REQUIRED = 1;\n\nexport default class FlingGestureHandler extends GestureHandler {\n  private numberOfPointersRequired = DEFAULT_NUMBER_OF_TOUCHES_REQUIRED;\n  private direction = DEFAULT_DIRECTION;\n\n  private maxDurationMs = DEFAULT_MAX_DURATION_MS;\n  private minAcceptableDelta = DEFAULT_MIN_ACCEPTABLE_DELTA;\n  private delayTimeout!: number;\n\n  private startX = 0;\n  private startY = 0;\n\n  private maxNumberOfPointersSimultaneously = 0;\n\n  public init(ref: number, propsRef: React.RefObject<unknown>): void {\n    super.init(ref, propsRef);\n  }\n\n  public updateGestureConfig({ enabled = true, ...props }: Config): void {\n    super.updateGestureConfig({ enabled: enabled, ...props });\n\n    this.enabled = enabled;\n\n    if (this.config.direction) {\n      this.direction = this.config.direction;\n    }\n\n    if (this.config.numberOfPointers) {\n      this.numberOfPointersRequired = this.config.numberOfPointers;\n    }\n  }\n\n  protected transformNativeEvent() {\n    const rect: DOMRect = this.view.getBoundingClientRect();\n\n    return {\n      x: this.tracker.getLastAvgX() - rect.left,\n      y: this.tracker.getLastAvgY() - rect.top,\n      absoluteX: this.tracker.getLastAvgX(),\n      absoluteY: this.tracker.getLastAvgY(),\n    };\n  }\n\n  private startFling(event: AdaptedEvent): void {\n    this.startX = event.x;\n    this.startY = event.y;\n\n    this.begin();\n\n    this.maxNumberOfPointersSimultaneously = 1;\n\n    this.delayTimeout = setTimeout(() => this.fail(), this.maxDurationMs);\n  }\n\n  private tryEndFling(event: AdaptedEvent): boolean {\n    if (\n      this.maxNumberOfPointersSimultaneously ===\n        this.numberOfPointersRequired &&\n      ((this.direction & Direction.RIGHT &&\n        event.x - this.startX > this.minAcceptableDelta) ||\n        (this.direction & Direction.LEFT &&\n          this.startX - event.x > this.minAcceptableDelta) ||\n        (this.direction & Direction.UP &&\n          this.startY - event.y > this.minAcceptableDelta) ||\n        (this.direction & Direction.DOWN &&\n          event.y - this.startY > this.minAcceptableDelta))\n    ) {\n      clearTimeout(this.delayTimeout);\n      this.activate();\n\n      return true;\n    }\n\n    return false;\n  }\n\n  private endFling(event: AdaptedEvent) {\n    if (!this.tryEndFling(event)) {\n      this.fail();\n    }\n  }\n\n  protected onPointerDown(event: AdaptedEvent): void {\n    this.tracker.addToTracker(event);\n    super.onPointerDown(event);\n    this.newPointerAction(event);\n  }\n\n  protected onPointerAdd(event: AdaptedEvent): void {\n    this.tracker.addToTracker(event);\n    super.onPointerAdd(event);\n    this.newPointerAction(event);\n  }\n\n  private newPointerAction(event: AdaptedEvent): void {\n    if (this.currentState === State.UNDETERMINED) {\n      this.startFling(event);\n    }\n\n    if (this.currentState !== State.BEGAN) {\n      return;\n    }\n\n    this.tryEndFling(event);\n\n    if (\n      this.tracker.getTrackedPointersCount() >\n      this.maxNumberOfPointersSimultaneously\n    ) {\n      this.maxNumberOfPointersSimultaneously = this.tracker.getTrackedPointersCount();\n    }\n  }\n\n  protected onPointerMove(event: AdaptedEvent): void {\n    this.tracker.track(event);\n\n    if (this.currentState !== State.BEGAN) {\n      return;\n    }\n\n    this.tryEndFling(event);\n\n    super.onPointerMove(event);\n  }\n\n  protected onPointerUp(event: AdaptedEvent): void {\n    super.onPointerUp(event);\n    this.onUp(event);\n  }\n\n  protected onPointerRemove(event: AdaptedEvent): void {\n    super.onPointerRemove(event);\n    this.onUp(event);\n  }\n\n  private onUp(event: AdaptedEvent): void {\n    this.tracker.removeFromTracker(event.pointerId);\n    if (this.currentState !== State.BEGAN) {\n      return;\n    }\n    this.endFling(event);\n  }\n\n  protected onPointerCancel(event: AdaptedEvent): void {\n    super.onPointerCancel(event);\n    this.reset();\n  }\n\n  public activate(force?: boolean): void {\n    super.activate(force);\n    this.end();\n  }\n\n  protected resetConfig(): void {\n    super.resetConfig();\n    this.numberOfPointersRequired = DEFAULT_NUMBER_OF_TOUCHES_REQUIRED;\n    this.direction = DEFAULT_DIRECTION;\n  }\n}\n"]}